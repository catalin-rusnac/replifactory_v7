import{_ as G,l as d,q as J,H as v,c as p,g as a,w as o,b as i,f,e as R,t as _,h as r,r as m,o as u,I as K,F as U,d as $}from"./index-DO46mX6s.js";const Q={key:0,class:"mt-3"},W=["src"],X={key:2,class:"mt-3"},Z=["src"],ee={key:3,class:"mt-3"},oe={key:0,class:"mb-2"},te={key:0,class:"d-block"},ae={key:1,class:"d-block"},le={class:"mb-2"},re=["src"],se=["innerHTML"],ne={__name:"StatusTab",setup(ce){const h=d(""),C=d(null),L=d("html"),y=d(null),g=d(null),V=d(!1),w=d(0),k=d(null),x=d(0),b=d(!1),E=d("");async function T(){if(b.value){try{await v.post("/camera/stream/stop")}catch(t){console.error("Error stopping stream:",t)}b.value=!1,E.value=""}else b.value=!0,E.value=`${v.defaults.baseURL}/camera/stream`}async function B(){try{const t=await v.get("/download_db",{responseType:"blob"}),e=new Blob([t.data],{type:"application/octet-stream"}),l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=document.title+"_replifactory.db",document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(t){console.error("Error downloading database:",t)}}async function I(t,e){try{const l=await v.get(`/export/${t}/${e}`,{responseType:"blob"}),c=new Blob([l.data],{type:"application/octet-stream"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=`vial_${t}_data.${e}`,document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(l){console.error(`Error exporting data for vial ${t}:`,l)}}async function z(){try{const t=await v.get("/camera/capture",{responseType:"arraybuffer"}),e=btoa(new Uint8Array(t.data).reduce((l,c)=>l+String.fromCharCode(c),""));C.value=`data:image/jpeg;base64,${e}`}catch(t){console.error("Error capturing image:",t)}}function D(){if(g.value){const t=document.createElement("a");t.href=y.value;const e=new Date().toISOString().replace(/[:.]/g,"-");t.download=`video_${e}.mp4`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}async function F(t){try{V.value=!0,w.value=0,x.value=t,k.value=setInterval(()=>{w.value+=100/t,w.value>=100&&clearInterval(k.value)},1e3),console.log("Requesting video...");const e=await v.get(`/camera/video/${t}`,{responseType:"blob"});console.log("Video response received:",e),g.value=e.data;const l=new Blob([e.data],{type:"video/mp4"});y.value=URL.createObjectURL(l),V.value=!1,w.value=0,x.value=0,clearInterval(k.value)}catch(e){console.error("Error capturing video:",e),console.error("Error details:",e.response),V.value=!1,w.value=0,x.value=0,clearInterval(k.value)}}async function j(){try{const t=await v.get("/camera/segment",{responseType:"arraybuffer"}),e=btoa(new Uint8Array(t.data).reduce((l,c)=>l+String.fromCharCode(c),""));C.value=`data:image/jpeg;base64,${e}`}catch(t){console.error("Error segmenting image:",t)}}async function M(){var t,e;try{const l=await v.post("/camera/force_reset");console.log("Camera reset response:",l.data),alert("Camera reset successful")}catch(l){console.error("Error resetting camera:",l),alert("Failed to reset camera: "+(((e=(t=l.response)==null?void 0:t.data)==null?void 0:e.error)||l.message))}}return J(async()=>{if(b.value){try{await v.post("/camera/stream/stop")}catch(t){console.error("Error stopping stream on unmount:",t)}b.value=!1,E.value=""}k.value&&clearInterval(k.value)}),(t,e)=>{const l=m("v-icon"),c=m("v-btn"),s=m("v-col"),N=m("v-list-item-title"),O=m("v-list-item"),H=m("v-list"),P=m("v-menu"),S=m("v-row"),q=m("v-progress-linear"),A=m("v-select");return u(),p("div",null,[a(S,{class:"mt-3"},{default:o(()=>[a(s,{cols:"3"},{default:o(()=>[a(c,{color:"info",onClick:z},{default:o(()=>[a(l,{size:"large"},{default:o(()=>e[3]||(e[3]=[r("mdi-camera")])),_:1}),e[4]||(e[4]=r(" Photo "))]),_:1})]),_:1}),a(s,{cols:"3"},{default:o(()=>[a(c,{color:"success",onClick:j,disabled:!C.value},{default:o(()=>[a(l,{size:"large"},{default:o(()=>e[5]||(e[5]=[r("mdi-image-filter-center-focus")])),_:1}),e[6]||(e[6]=r(" Segment "))]),_:1},8,["disabled"])]),_:1}),a(s,{cols:"3"},{default:o(()=>[a(P,null,{activator:o(({props:n})=>[a(c,K({color:"warning"},n),{default:o(()=>[a(l,{size:"large"},{default:o(()=>e[7]||(e[7]=[r("mdi-video")])),_:1}),e[8]||(e[8]=r(" Video "))]),_:2},1040)]),default:o(()=>[a(H,null,{default:o(()=>[(u(),p(U,null,$([5,10,25],n=>a(O,{key:n,onClick:Y=>F(n)},{default:o(()=>[a(N,null,{default:o(()=>[a(l,{color:"warning",class:"mr-2"},{default:o(()=>e[9]||(e[9]=[r("mdi-clock-outline")])),_:1}),r(" "+_(n)+" seconds ",1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1}),a(s,{cols:"3"},{default:o(()=>[a(c,{color:"error",onClick:T},{default:o(()=>[a(l,{size:"large"},{default:o(()=>e[10]||(e[10]=[r("mdi-video-outline")])),_:1}),r(" "+_(b.value?"Stop Stream":"Live Stream"),1)]),_:1})]),_:1}),a(s,{cols:"3"},{default:o(()=>[a(c,{color:"success",onClick:B},{default:o(()=>[a(l,{size:"large"},{default:o(()=>e[11]||(e[11]=[r("mdi-cloud-download")])),_:1}),e[12]||(e[12]=r(" Download Database "))]),_:1})]),_:1})]),_:1}),a(S,{class:"mt-2"},{default:o(()=>[a(s,{cols:"12",class:"text-center"},{default:o(()=>[a(c,{color:"error",onClick:M,class:"mt-2"},{default:o(()=>[a(l,{size:"large"},{default:o(()=>e[13]||(e[13]=[r("mdi-camera-refresh")])),_:1}),e[14]||(e[14]=r(" Force Reset Camera "))]),_:1})]),_:1})]),_:1}),b.value?(u(),p("div",Q,[e[15]||(e[15]=i("div",{class:"mb-2"},[i("small",null,"Live Stream")],-1)),i("img",{src:E.value,class:"img-fluid",style:{"max-width":"100%",height:"auto"}},null,8,W)])):f("",!0),V.value?(u(),R(S,{key:1,class:"mt-3"},{default:o(()=>[a(s,{cols:"12"},{default:o(()=>[a(q,{"model-value":w.value,color:"warning",height:"20"},{default:o(({value:n})=>[i("strong",null,"Recording: "+_(Math.ceil(n))+"% ("+_(x.value)+"s)",1)]),_:1},8,["model-value"])]),_:1})]),_:1})):f("",!0),C.value?(u(),p("div",X,[i("img",{src:C.value,class:"img-fluid"},null,8,Z)])):f("",!0),y.value?(u(),p("div",ee,[y.value?(u(),p("div",oe,[i("small",null,"Video URL: "+_(y.value),1),g.value?(u(),p("small",te,"Video size: "+_((g.value.size/1024/1024).toFixed(2))+" MB",1)):f("",!0),g.value?(u(),p("small",ae,"Video type: "+_(g.value.type),1)):f("",!0)])):f("",!0),i("div",le,[g.value?(u(),R(c,{key:0,color:"primary",onClick:D},{default:o(()=>e[16]||(e[16]=[r(" Download Video ")])),_:1})):f("",!0)]),i("video",{controls:"",class:"img-fluid",style:{"max-width":"100%",height:"auto"},onError:e[0]||(e[0]=n=>console.error("Video error:",n)),onLoadeddata:e[1]||(e[1]=()=>console.log("Video loaded"))},[i("source",{src:y.value,type:"video/mp4"},null,8,re),e[17]||(e[17]=r(" Your browser does not support the video tag. "))],32)])):f("",!0),a(S,{class:"mt-3",align:"center"},{default:o(()=>[a(s,{cols:"3",class:"text-right"},{default:o(()=>e[18]||(e[18]=[i("strong",null,"Export Data",-1)])),_:1}),a(s,{cols:"3"},{default:o(()=>[a(A,{modelValue:L.value,"onUpdate:modelValue":e[2]||(e[2]=n=>L.value=n),items:["csv","html"],label:"Select Format",dense:""},null,8,["modelValue"])]),_:1}),a(s,{cols:"6"},{default:o(()=>[(u(),p(U,null,$(7,n=>a(c,{key:"vial"+n,color:"info",class:"mr-1 mb-1",onClick:Y=>I(n,L.value)},{default:o(()=>[r(" Vial "+_(n),1)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1}),i("div",{class:"mt-3",innerHTML:h.value},null,8,se)])}}},ie=G(ne,[["__scopeId","data-v-3bd3d6bb"]]);export{ie as default};
