import{C as T,r as F,u as w}from"./vuex.esm-bundler-cd2d87f8.js";import{_ as O,c as C,g as D,A as E,r as b,o as k,a as I,b as y,k as v,j as s,i as c,P as L}from"./index-90ae7a18.js";T.register(...F);const A={__name:"StirrerTest",setup(R,{expose:g}){const n=w(),h=C(()=>n.state.device.isFetchingCalibration),d=C(()=>n.state.device.stirrers.speed_profiles),u=D(null);let r=null;function e(a){r&&r.destroy();const t=[],o=["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(201, 203, 207, 1)"];let l=0;for(const[i,x]of Object.entries(a)){const m=[];for(const[p,S]of Object.entries(x)){const $=parseFloat(p),P=S.map(Number),N=P.reduce((B,j)=>B+j,0)/P.length;m.push({x:$,y:N})}m.sort((p,S)=>p.x-S.x),t.push({label:`Stirrer ${i}`,data:m,borderColor:o[l%o.length],backgroundColor:o[l%o.length],fill:!1,tension:.1}),l++}u.value&&(r=new T(u.value,{type:"line",data:{datasets:t},options:{responsive:!0,scales:{x:{type:"linear",position:"bottom",min:0,max:1.02,title:{display:!0,text:"Duty Cycle"}},y:{min:0,max:1e4,title:{display:!0,text:"Revolutions per Minute"}}}}}))}function _(){return r?r.toBase64Image():""}g({getChartImage:_});const f=async()=>{await n.dispatch("device/fetchStirrerCalibrationData"),await n.dispatch("device/getAllDeviceData"),d.value&&e(d.value)};return E(d,a=>{a&&e(a)}),(a,t)=>{const o=b("v-btn");return k(),I("div",null,[y("h2",null,[t[1]||(t[1]=v("Stirrer Speed Profiles ")),s(o,{onClick:f,disabled:h.value},{default:c(()=>t[0]||(t[0]=[v(" Remeasure (approx. 2 min) ")])),_:1},8,["disabled"])]),y("canvas",{ref_key:"chartCanvas",ref:u},null,512)])}}},U=O(A,[["__scopeId","data-v-3dde2bfa"]]);const V={__name:"ODTest",setup(R,{expose:g}){const n=w(),h=C(()=>n.state.device.isFetchingCalibration),d=C(()=>n.state.device.ods.max_signal),u=D(null);let r=null;function e(a){const t=[],o={red:"rgba(255, 0, 0, 1)",green:"rgba(0, 255, 0, 1)",blue:"rgba(0, 0, 255, 1)",laser:"rgba(139, 0, 0, 1)"};[{key:"laser",label:"Laser (nominal power)"},{key:"red",label:"Red LED (max power)"},{key:"green",label:"Green LED (max power)"},{key:"blue",label:"Blue LED (max power)"}].forEach(({key:i,label:x})=>{if(a[i]){const m=Object.keys(a[i]).map(p=>({x:parseInt(p,10),y:a[i][p]}));t.push({label:x,data:m,backgroundColor:o[i],borderColor:o[i],borderWidth:1,type:"bar"})}}),r&&r.destroy(),u.value&&(r=new T(u.value,{type:"bar",data:{datasets:t},options:{responsive:!0,scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Vial"}},y:{title:{display:!0,text:"Signal [mV]"}}}}}))}function _(){return r?r.toBase64Image():""}g({getChartImage:_});async function f(){console.log("Running OD test..."),await n.dispatch("device/fetchODCalibrationData"),console.log("OD test completed. Plotting data..."),await n.dispatch("device/getAllDeviceData"),d.value?e(d.value):console.error("No OD signal data available.")}return E(d,a=>{a&&e(a)}),(a,t)=>{const o=b("v-btn");return k(),I("div",null,[y("h2",null,[t[1]||(t[1]=v(" Transmitted Light Intensity ")),s(o,{onClick:f,disabled:h.value},{default:c(()=>t[0]||(t[0]=[v(" Remeasure (approx. 5 sec) ")])),_:1},8,["disabled"])]),y("canvas",{ref_key:"chartCanvas",ref:u},null,512)])}}},M=O(V,[["__scopeId","data-v-3f8e6b86"]]);const H={__name:"SelfTest",setup(R){const g=w(),n=D(null),h=D(null),d=async()=>{await g.dispatch("device/getAllDeviceData")};function u(){var x,m,p;const r=((x=n.value)==null?void 0:x.getChartImage())||"",e=((m=h.value)==null?void 0:m.getChartImage())||"";if((p=cameraRef.value)!=null&&p.getCameraMedia(),!r||!e){alert("Please run all tests before exporting.");return}const _=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Self Test Report</title>
</head>
<body>
  <h1>Self Test Report</h1>

  <h2>Stirrer Speed Profiles</h2>
  ${r?`<img src="${r}" alt="Stirrer Chart" style="max-width: 100%;" />`:"<p>No stirrer chart available</p>"}

  <h2>Transmitted Light Intensity</h2>
  ${e?`<img src="${e}" alt="OD Chart" style="max-width: 100%;" />`:"<p>No OD chart available</p>"}

  <p>Exported from the interactive dashboard</p>
</body>
</html>
  `,f=g.state.hostname||"device",a=new Date().toISOString().split("T")[0],t=`${f}-self-test-report-${a}.html`,o=new Blob([_],{type:"text/html"}),l=URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download=t,i.click(),URL.revokeObjectURL(l)}return(r,e)=>{const _=b("v-icon"),f=b("v-btn"),a=b("v-tooltip"),t=b("v-col"),o=b("v-row");return k(),I("div",null,[s(o,null,{default:c(()=>[s(t,null,{default:c(()=>[s(a,{text:"Plot test data stored on device"},{activator:c(({props:l})=>[s(f,L(l,{onClick:d}),{default:c(()=>[s(_,null,{default:c(()=>e[0]||(e[0]=[v("mdi-chart-line")])),_:1}),e[1]||(e[1]=v("Plot Self-Test Data "))]),_:2},1040)]),_:1})]),_:1}),s(t,null,{default:c(()=>[s(a,{text:"Export the current page as an HTML file"},{activator:c(({props:l})=>[s(f,L(l,{onClick:u}),{default:c(()=>[s(_,null,{default:c(()=>e[2]||(e[2]=[v("mdi-file-download")])),_:1}),e[3]||(e[3]=v(" Download Self-Test Report "))]),_:2},1040)]),_:1})]),_:1})]),_:1}),e[4]||(e[4]=y("br",null,null,-1)),s(U,{ref_key:"stirrerRef",ref:n},null,512),s(M,{ref_key:"odRef",ref:h},null,512)])}}},Y=O(H,[["__scopeId","data-v-55a39300"]]);export{Y as default};
