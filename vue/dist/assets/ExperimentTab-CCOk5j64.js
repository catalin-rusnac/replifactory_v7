import{V as I,m as V,a as y,_ as C,r as a,o as n,c as l,b as E,F as _,d as b,e as k,f as v,w as u,g as s,h as x,t as $,n as g,i as f}from"./index-r2WOc4ae.js";import{V as N}from"./VialPlot-CEWNviqU.js";const A={components:{VTextField:I},computed:{...V("experiment",["currentExperiment"])},methods:{...y("experiment",["updateExperimentParameters"]),async handleInputChange(e,t){this.currentExperiment.parameters[e]=t,await this.updateExperimentParameters({experimentId:this.currentExperiment.id,parameters:this.currentExperiment.parameters})}}},D={class:"experiment-parameters"},B={class:"stock-parameters"};function U(e,t,c,w,m,i){const d=a("v-text-field");return n(),l("div",D,[E("div",B,[(n(!0),l(_,null,b(e.currentExperiment.parameters,(h,r)=>(n(),l(_,{key:r},[r!=="cultures"&&r!=="growth_parameters"?(n(),k(d,{key:0,class:"stock-parameter-field",label:`${r}`,modelValue:this.currentExperiment.parameters[r],"onUpdate:modelValue":[o=>this.currentExperiment.parameters[r]=o,o=>i.handleInputChange(r,o)],readonly:e.currentExperiment.status==="running"},null,8,["label","modelValue","onUpdate:modelValue","readonly"])):v("",!0)],64))),128))])])}const M=C(A,[["render",U],["__scopeId","data-v-eadbba9e"]]),F={components:{ExperimentParameters:M},data(){return{newExperimentname:null,showCreate:!1,currentExperimentId:null}},computed:{...V("experiment",["experiments","currentExperiment","errorMessage"]),reversedExperiments(){return[...this.experiments].reverse()}},methods:{...y("experiment",["setCurrentExperimentAction","createExperiment","fetchExperiments","fetchCurrentExperiment","startExperiment","pauseExperiment","stopExperiment"]),async handleExperimentSelected(){(this.currentExperiment.status==="running"||this.currentExperiment.status==="paused")&&await this.stopExperiment(this.currentExperiment.id),await this.setCurrentExperimentAction(this.currentExperimentId)},async handleNewExperimentButton(){this.showCreate=!this.showCreate,(this.currentExperiment.status==="running"||this.currentExperiment.status==="paused")&&await this.stopExperiment(this.currentExperiment.id)},async createAndSelectExperiment(){this.currentExperiment?this.currentExperimentId=await this.createExperiment({name:this.newExperimentname,parameters:this.currentExperiment.parameters}):this.currentExperimentId=await this.createExperiment({name:this.newExperimentname}),await this.handleExperimentSelected(this.currentExperimentId),this.showCreate=!1,this.newExperimentname=""}},async created(){await this.fetchExperiments(),await this.fetchCurrentExperiment(),this.currentExperimentId=this.currentExperiment.id}},O={class:"experiment-setup"},T={class:"d-flex line-container"},z={class:"d-flex line-container"},j={key:0,class:"d-flex"},K={key:1};function L(e,t,c,w,m,i){const d=a("v-snackbar"),h=a("v-select"),r=a("v-btn"),o=a("v-text-field"),S=a("ExperimentParameters"),P=a("v-container");return n(),k(P,null,{default:u(()=>[s(d,{modelValue:e.errorMessage,"onUpdate:modelValue":t[0]||(t[0]=p=>e.errorMessage=p),timeout:"4000"},{default:u(()=>[x($(e.errorMessage),1)]),_:1},8,["modelValue"]),E("div",O,[E("div",T,[s(h,{modelValue:m.currentExperimentId,"onUpdate:modelValue":[t[1]||(t[1]=p=>m.currentExperimentId=p),i.handleExperimentSelected],items:i.reversedExperiments,"item-title":"name","item-value":"id",label:"Select Experiment",dense:"",outlined:"",class:"flex-grow-1 mt-3 experiment-select",style:{minWidth:"150px"}},null,8,["modelValue","items","onUpdate:modelValue"]),s(r,{color:"primary",onClick:i.handleNewExperimentButton,class:"mt-3",style:{height:"60px"},title:"New Experiment"},{default:u(()=>t[7]||(t[7]=[x("+")])),_:1},8,["onClick"])]),E("div",z,[s(r,{class:g(["start-button",{active:e.currentExperiment.status==="running"}]),style:f({"background-color":e.currentExperiment.status==="running"?"#28a745":"transparent"}),onClick:t[2]||(t[2]=p=>e.startExperiment()),color:"success",title:"Start the experiment loop - measure OD every minute and dilute the cultures as necessary, according to the parameters."},{default:u(()=>t[8]||(t[8]=[x(" Start ")])),_:1},8,["class","style"]),s(r,{class:g(["start-button",{active:e.currentExperiment.status==="paused"}]),style:f({"background-color":e.currentExperiment.status==="paused"?"#ffc107":"transparent"}),onClick:t[3]||(t[3]=p=>e.pauseExperiment()),title:"Pause the dilutions, but keep measuring the OD every minute.",color:"warning"},{default:u(()=>t[9]||(t[9]=[x(" Pause ")])),_:1},8,["class","style"]),s(r,{class:g(["start-button",{active:e.currentExperiment.status==="stopped"}]),style:f({"background-color":e.currentExperiment.status==="stopped"?"#dc3545":"transparent"}),onClick:t[4]||(t[4]=p=>e.stopExperiment()),onDblclick:t[5]||(t[5]=p=>e.forceStopExperiment()),color:"error",title:"Stop gracefully - wait for the current dilution to finish."},{default:u(()=>t[10]||(t[10]=[x(" Stop ")])),_:1},8,["class","style"])]),m.showCreate?(n(),l("div",j,[s(o,{modelValue:m.newExperimentname,"onUpdate:modelValue":t[6]||(t[6]=p=>m.newExperimentname=p),label:"New Experiment Name",outlined:"",dense:"",class:"flex-grow-1 mt-3"},null,8,["modelValue"]),s(r,{color:"success",onClick:i.createAndSelectExperiment,class:"ml-3 mt-3"},{default:u(()=>t[11]||(t[11]=[x("Create Experiment")])),_:1},8,["onClick"])])):v("",!0),e.currentExperiment?(n(),l("div",K,[s(S)])):v("",!0)])]),_:1})}const W=C(F,[["render",L],["__scopeId","data-v-aae0f767"]]),q={components:{VialPlot:N},name:"ExperimentChart",computed:{...V("experiment",["currentExperiment","selectedVials","plot_data"]),filteredVials(){return this.vials.filter(e=>this.selectedVials[e])}},data(){return{vials:[1,2,3,4,5,6,7]}},methods:{...y("experiment",["fetchCulturePlot","setSelectedVials"]),async plotAllData(){if(this.currentExperiment)for(let e of this.filteredVials)await this.fetchCulturePlot(e)},async toggleVial(e,t){let c;t.altKey?c={[e]:!0}:c={...this.selectedVials,[e]:!this.selectedVials[e]},this.setSelectedVials(c),c[e]&&await this.fetchCulturePlot(e)}},mounted(){this.plotAllData()}},G={id:"CulturePlot"},H={class:"control-container"},J={class:"button-row"},Q={class:"button-container"};function R(e,t,c,w,m,i){const d=a("v-btn"),h=a("VialPlot");return n(),l("div",G,[E("div",H,[E("div",J,[s(d,{class:"plot-button",color:"success",onClick:i.plotAllData,title:"Plot selected vials. alt-click to select single vial"},{default:u(()=>t[0]||(t[0]=[x("Plot Data")])),_:1},8,["onClick"]),E("div",Q,[(n(!0),l(_,null,b(m.vials,r=>(n(),l("div",{key:r,class:"button-item"},[s(d,{color:e.selectedVials[r]?"primary":"secondary",style:f({"background-color":e.selectedVials[r]?"#007bff":"transparent"}),onClick:o=>i.toggleVial(r,o),id:`vial-button-${r}`},{default:u(()=>[x($(`Vial ${r}`),1)]),_:2},1032,["color","style","onClick","id"])]))),128))])])]),(n(!0),l(_,null,b(i.filteredVials,r=>(n(),l("div",{key:r},[s(h,{vial:r,data:e.plot_data[r]},null,8,["vial","data"])]))),128))])}const X=C(q,[["render",R],["__scopeId","data-v-db21c445"]]),Y={components:{ExperimentSetup:W,ExperimentChart:X},computed:{...V("experiment",["experiments","currentExperiment","errorMessage"])}};function Z(e,t,c,w,m,i){var r,o;const d=a("ExperimentSetup"),h=a("ExperimentChart");return n(),l("div",null,[s(d),Object.keys(((o=(r=e.currentExperiment)==null?void 0:r.parameters)==null?void 0:o.cultures)||{}).length>0?(n(),k(h,{key:0})):v("",!0)])}const re=C(Y,[["render",Z]]);export{re as default};
